<!-- templates/mailing_service/client_list.html -->
{% extends 'mailing_service/base.html' %}
{% block content %}
  <h2>Список клиентов</h2>
  <form id="client-list-form" method="post">
    {% csrf_token %}
    <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Почта</th>
          <th scope="col">Имя</th>
          <th scope="col">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for client in clients %}
          <tr>
            <th scope="row"><input type="checkbox" name="selected_clients[]" value="{{ client.pk }}"></th>
            <td>{{ client.email }}</td>
            <td>{{ client.full_name }}</td>
            <td>
              <a href="{% url 'mailing_service:client_delete' client.pk %}" class="btn btn-sm btn-danger">Удалить</a>
              <a href="{% url 'mailing_service:client_update' client.pk %}" class="btn btn-sm btn-primary">Редактировать</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div>
      <button type="button" id="select-all-button" class="btn btn-primary">Выбрать всех</button>
      <button type="submit" name="delete_selected" class="btn btn-danger">Удалить выбранных</button>
    </div>
  </form>
  <div style="margin-top: 10px;">
    <a href="{% url 'mailing_service:client_create' %}" class="btn btn-success">Добавить нового клиента</a>
  </div>

  <!-- JavaScript для выбора всех чекбоксов -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const selectAllButton = document.getElementById('select-all-button');
      const checkboxes = document.querySelectorAll('input[type="checkbox"][name="selected_clients[]"]');

      let selectAll = false; // Флаг для отслеживания состояния "Выбрать всех"

      selectAllButton.addEventListener('click', function () {
        selectAll = !selectAll; // Инвертируем состояние "Выбрать всех"
        checkboxes.forEach(checkbox => {
          checkbox.checked = selectAll; // Устанавливаем состояние всех чекбоксов в соответствии с состоянием "Выбрать всех"
        });
        // Изменяем текст кнопки в зависимости от состояния
        selectAllButton.textContent = selectAll ? 'Отменить выбор всех' : 'Выбрать всех';
      });
    });
  </script>
{% endblock %}
